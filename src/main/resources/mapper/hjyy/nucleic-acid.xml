<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.julong.nucleicacid.dao.NucleicAcidMapper">

    <select id="getGeneratorNo" resultType="java.lang.String">
        select lpad( to_char(CURRENTNO) ,nolength , nvl(prefix,'0') )  from SM_NOGENERATOR where notype = #{noType}
    </select>

    <select id="getOutpatientInfo" resultType="com.julong.nucleicacid.model.OutpatientInfoOut">
        select
        --patientId	res	String	是	患者ID
        to_char(pat.PATIENTID) AS patientId,
        --patientName	res	String	是	患者姓名
        pat.NAME AS patientName,
        --gender	res	String	是	用户性别：M-男性 F-女性
        decode(pat.SEX,1,'M',2,'F',to_char(pat.SEX)) AS gender,
        --healthCardNo	res	String	是	健康卡号码
        pat.HCNO AS healthCardNo,
        --idCardNo	res	String	否	身份证
        pat.IDNO AS idCardNo,
        --birthday	res	String	否	出生日期
        to_char(pat.BIRTHPLACE, 'yyyy-MM-dd') AS birthday,
        --oppatNo	res	String	否	患者病历号
        '-' AS oppatNo,
        --phone	res	String	否	联系电话
        pat.MOBILE AS phone,
        --medicareCardNo	res	String	否	医保卡号
        '-' AS medicareCardNo,
        --homeAddress	res	String	否	家庭住址
        pat.ADDRESS AS homeAddress,
        --remark	res	String	否	备注
        '-' AS remark,
        --feeType	res	String	否	结算类型代码，1.医保 2自费 3公医 4省医
        decode(pat.PAYORID, 3,'2',4,'3',9,'4',to_char(pat.PAYORID)) AS feeType,
        --userTag	res	String	否	用户标签
        '-' AS userTag
        from PA_DATA_PATIENT pat
        <where>
            <if test=" idCardNo!=null and idCardNo !=''">
            and pat.IDNO = #{idCardNo}
            </if>
            <if test=" healthCardNo!=null and healthCardNo !=''">
            AND pat.HCNO = #{healthCardNo}
            </if>
            <if test=" patientId!=null and patientId !=''">
            AND to_char(pat.PATIENTID) = #{patientId}
            </if>

        </where>
    </select>
    <select id="nucleicGetItem" resultType="com.julong.nucleicacid.model.GetItemOutSet">
        select
        --itemId	set	String	是	套餐代码
        to_char(abo.ITEMID) AS itemId,
        --itemName	set	String	是	套餐名称
        abo.ITEMNAME AS itemName,
        --totalFee	set	String	是	套餐总金额，单位：分
        abo.PRICE AS totalFee
        from AB_ORDERITEM abo, AB_ORDERGROUPITEM abg
        where abg.ITEMID = abo.ITEMID and abg.GROUPID = #{groupId}


    </select>
    <select id="getGroupItems" resultType="java.lang.Long">
        select a.ITEMID as xmid  from  AB_ORDERGROUPITEM  a
		where a.GROUPID = #{groupId}
    </select>
    <select id="getGroupUnitPrice" resultType="java.math.BigDecimal">
        select sum(nvl(b.CLPRICE,0) ) as zdj from AB_ORDERGROUP a , ab_orderitem b , AB_ORDERGROUPITEM r
		where a.GROUPID = r.GROUPID and r.ITEMID = b.ITEMID and a.GROUPID = #{groupId}
    </select>
    <select id="getGroupAmount" resultType="java.math.BigDecimal">
        select sum( nvl(r.AMOUNT,1)  * nvl(b.CLPRICE,0) ) as zdj from AB_ORDERGROUP a , ab_orderitem b  , AB_ORDERGROUPITEM r
		where  a.GROUPID = r.GROUPID and r.ITEMID = b.ITEMID and a.GROUPID = #{groupId}

    </select>
    <select id="getOrderItemPretype" resultType="java.lang.Long">
        select nvl( p.PRETYPE,2)  as lb   from ab_orderitem o , PC_PRESCRIPTIONSUBCATALOG p
		where o.CATALOGID = p.PRESUBCATAID and o.ITEMID = #{itemId}
    </select>
    <select id="">
       ----clinicSeq	payListInfo	String	是	就诊流水号*/
       ----clinicTime	payListInfo	String	是	就诊日期*/
       ----hospitalId	payListInfo	String	是	医院代码*/
       ----deptId	payListInfo	String	是	接诊科室代码*/
       ----deptName	payListInfo	String	是	接诊科室名称*/
       ----doctorId	payListInfo	String	是	接诊医生代码*/
       ----doctorName	payListInfo	String	是	接诊医生姓名*/
       ----payAmout	payListInfo	String	是	自费金额(单位：分)*/
       ----recPayAmout	payListInfo	String	是	统筹金额(单位：分)*/
       ----totalPayAmout	payListInfo	String	是	总金额(单位：分)*/
       ----receiptId	payListInfo	String	是	收据ID*/
       ----chargeDate	payListInfo	String	是	缴费日期*/
       ----remark	payListInfo	String	否	备注*/
       ----orderId	payListInfo	String	否	支付平台订单号*/
       ----allowRefund	payListInfo	String	否	是否允许退费，1表示允许退费，0表示不允许，默认值为0*/
       ----prescriptionIds	payListInfo	String	否	处方号,允许线上退费时必须*/
       ----refundType	payListInfo	String	否	退费方式，线上退费填"online"*/
       ----refundNo	payListInfo	String	否	退费流水号，refundStatus=1或者2时必须*/
       ----refundStatus	payListInfo	orderInfo	否	退费状态 0已支付1退费中 2 已退费*/
       ----refundFee	payListInfo	String	否	退费自费金额，单位分*/
       ----refundTime	payListInfo	String	否	退费时间yyyy-MM-dd HH:mm:ss*/
       ----hasExpress	payListInfo	String	否	是否有药品快递信息 1包含 0不包含*/
       ----deliveryStatus	payListInfo	String	否	药品物流状态 0 或空，不支持配送 1 可配送 2 已配送*/
       ----medicineCode	payListInfo	String	否	取药码*/
       ----pickUpLocation	payListInfo	String	否	取药药房*/


    </select>
    <select id="getUnChrgRecipeFO" resultType="com.julong.nucleicacid.entity.UnChrgRecipeFO">
        select
            to_char( cf.RECIPEID ) as RECIPEID,
            to_char( cf.PATIENTID ) as PATIENTID,
            nvl( to_char(cf.deptid),'-1') as deptid
        from pc_cl_data_recipe cf , pa_data_patient br
        where cf.PATIENTID = br.PATIENTID
        and br.HCNO = :cardNo
        and not exists ( select cf1.recipeid  from pc_cl_data_recipe cf1 where cf1.ENCOUNTERID = cf.ENCOUNTERID
          and nvl(cf1.SOCIALTYPE,'9') &lt;> '9'   and cf1.isdelete = '0' and cf1.ischarge = '0'
        )   --处方中的自费
        and br.ISDELETE = '0'  and cf.ISDELETE = '0' and cf.isCharge = '0'
       and to_char(cf.INPUTTIME,'yyyy-mm-dd') > to_char(sysdate - :limitDay , 'yyyy-mm-dd')
        and to_char(cf.INPUTTIME,'yyyy-mm-dd') between :beginDate and  :endDate
    order by cf.PATIENTID,cf.ENCOUNTERID,cf.RECIPEID

    </select>
    <select id="getPayInfo" resultType="com.julong.nucleicacid.model.GetPayInfoOutSet">
    select
    --clinicSeq	payListInfo	String	是	就诊流水号
    to_char(cf.ENCOUNTERID) AS clinicSeq,
    --clinicTime	payListInfo	String	是	就诊日期
    to_char(cf.INPUTTIME,'yyyy-MM-dd') AS clinicTime,
    --hospitalId	payListInfo	String	是	医院代码
    '-' AS hospitalId,
    --deptId	payListInfo	String	是	接诊科室代码
    to_char(cf.DEPTID) AS deptId,
    --deptName	payListInfo	String	是	接诊科室名称
    (select DEPTNAME from OM_DEPARTMENT where DEPTID=cf.DEPTID ) AS deptName,
    --doctorId	payListInfo	String	是	接诊医生代码
    to_char(cf.DOCID) AS doctorId,
    --doctorName	payListInfo	String	是	接诊医生姓名
    (select USERNAME from SM_USER where USERID= cf.DOCID) AS doctorName,
    --payAmout	payListInfo	String	是	未缴费总金额，单位：分
    (select to_char( sum(  nvl( decode( pce.ISCHARGE , '1' ,  pce.AMOUNT,0 ),0)))  from PC_CL_DATA_RECIPEENTRY pce where pce.RECIPEID = cf.RECIPEID) AS payAmout,
    --settleCode	payListInfo	String	是	结算类型代码，自费00
    '00' AS settleCode,
    --必填参数，，否则页面会显示null
    --settleType	payListInfo	String	否	结算类型名称,自费时可空
    '' AS settleType,
    --outpatientType	payListInfo	String	否	诊间支付类型：	（空字符串或0：普通线上诊间支付模式；1：充值模式）
    '' AS outpatientType,
    --prescriptionIds	payListInfo	String	否	处方号
    to_char( cf.RECIPEID ) AS prescriptionIds,
    --isFirstPay	payListInfo	String	否	是否优先支付 1是0 否
    '' AS isFirstPay
    --
    from pc_cl_data_recipe cf , pa_data_patient br
    where cf.PATIENTID = br.PATIENTID
      and not exists ( select cf1.recipeid  from pc_cl_data_recipe cf1 where cf1.ENCOUNTERID = cf.ENCOUNTERID
                                                                         and nvl(cf1.SOCIALTYPE,'9') != '9'   and cf1.isdelete = '0' and cf1.ischarge = '0'
        )   --处方中的自费
      and br.ISDELETE = '0'  and cf.ISDELETE = '0' and cf.isCharge = '0'
      and to_char(cf.INPUTTIME,'yyyy-mm-dd') > to_char(sysdate - #{limitDay} , 'yyyy-mm-dd')
      <if test=" beginDate!=null and beginDate !=''">
      and to_char(cf.INPUTTIME,'yyyy-mm-dd') >= #{beginDate}
      </if>
        <if test=" beginDate!=null and beginDate !=''">
      and to_char(cf.INPUTTIME,'yyyy-mm-dd') &lt;=  #{endDate}
      </if>
      and br.HCNO = #{cardNo}
    order by cf.PATIENTID,cf.ENCOUNTERID,cf.RECIPEID
    </select>
    <select id="getPaybillfee" resultType="com.julong.nucleicacid.model.GetPaybillfeeOut">

        --payAmout	res	String	是	自费金额(单位：分)
        --recPayAmout	res	String	是	统筹金额(单位：分)
        --totalPayAmout	res	String	是	总金额(单位：分)
        --prescriptionIds	res	String	是	处方号，多个处方号用半角逗号分隔
        --remark	res	String	否	备注信息
        --medicareSettleLogId	res	String	否	医保预结算参数若使用线上医保结算，参数格式必须json格式：{“serial_no”:”业务流水号”,“bill_no”:”业务单据号”}
        --insuranType	res	String	否	参保类型代码，KID02代表少儿医保结算
        --prescriptionContent	res	String	否	处方单详细内容，具体格式以当地人社局系统要求为准线上医保结算时，必须传入。包含<![CDATA[]]>标签。当该透传体不为空时，平台会调用medicare.getOnlineMedicareSettle接口，重新构造透传体
        --isDecoction	res	String	否	是否代煎，1表示需要 0或者空不需要
        --isDelivery	res	String	否	是否需要配送 1表示需要 0或者空不需要
        --isInformedConsent	res	String	否	是否有知情同意书需要确认 1表示需要 0或者空不需要
        --isMedicinalDetail	res	String	否	是否查看药品明细 （1有，0 无）
        --citizenCardAmount 	res	String	否	市民卡金额(单位：分)
        --citizenCardAmountName	res	String	否	市民卡金额显示名称,可自定义为其他名称
        --hospitalCardAmount	res	String	否	院内卡金额(单位：分)
        --hospitalCardAmountName	res	String	否	院内卡金额显示名称,可自定义为其他名称


    </select>
    <resultMap id="getRecipsbyRecIdsMap" type="com.julong.nucleicacid.entity.UnChrgRecipeBillFO">
        <id column="encounterid" property="encounterid"/>
        <collection  property="recipeids"  ofType="String">
        <constructor>
            <arg column="recipeid" />
        </constructor>
        </collection>
        <collection property="getPaybillfeeOutSets" ofType="com.julong.nucleicacid.model.GetPaybillfeeOutSet">
            <result column="typeCode" property="typeCode"/>
            <result column="typeName" property="typeName"/>
            <result column="typeAmout" property="typeAmout" />
        </collection>
    </resultMap>
    <select id="getRecipsbyRecIds" resultMap="getRecipsbyRecIdsMap" resultType="com.julong.nucleicacid.entity.UnChrgRecipeBillFO"  parameterType="java.util.List">
    select
        a.encounterid AS encounterid,
        a.RECIPEID AS recipeid,
        b.ITEMID AS typeCode,
        (select ITEMNAME from AB_ORDERITEM where ITEMID = b.ITEMID) AS typeName,
        to_char(nvl( decode( b.ISCHARGE , '1' ,  b.AMOUNT,0 ),0))   AS typeAmout

    from PC_CL_DATA_RECIPE a , PC_CL_DATA_RECIPEENTRY b
    where a.recipeid = b.recipeid
        <if test="recIds != null">and a.RECIPEID in
        <foreach collection="recIds" item="recId" index="index" open="(" close=")" separator=",">
        #{recId}
        </foreach>
        </if>

    </select>
    <select id="getRecentry" resultType="com.julong.nucleicacid.entity.RecentryItem">
        select   c.ITEMNAME as fitemname,
               to_char(cf.ITEMID) as fitemcode,
               '20' AS ftypecode,
               ( select unitname from MA_UNIT where unitid = c.UNITID and rownum &lt; 2 ) as faunitname,
               c.PRICE as Fprice,
               c.standard as Std,
               cf.QUANTITY as Famount,
               cf.amount as Fsum,
               c.CATALOGID as itemcls,
               '0' AS fisappend,
                '0' AS Ffjf,
               cft.ISCHARGE as ISCHARGE,
               cft.ISDELETE as ISDELETE,
               ( select sum(AMOUNT) from PC_CL_DATA_RECIPEENTRY a where a.ischarge = '1' and a.RECIPEID = cf.recipeid ) as AmountAll,
               cft.PATIENTID as PATIENTID  ,
               nvl(cf.EXEUTEDEPT,-1) as ExecuteDept,
               nvl(cf.entrytype,-1) as EntryType
         from PC_CL_DATA_RECIPEENTRY cf , AB_ORDERITEM c , pc_cl_data_recipe cft
         where cf.ITEMID = c.ITEMID   and cft.recipeid = cf.recipeid
         and cf.recipeid = #{oneRecNo}
    </select>
    <select id="getRecipsbyEncounterID" resultType="java.lang.String">

        select  to_char( wm_concat(a.RECIPEID) )
        from PC_CL_DATA_RECIPE a where RECIPEID in
        <foreach  collection="recNoListLong" item="recNo" index="index"
                  open="(" close=")" separator=",">
            #{recNo}
        </foreach>

        group by a.ENCOUNTERID
    </select>
    <select id="getClRecentryFOs" resultType="com.julong.nucleicacid.entity.ClRecentryFO">
        select * from PC_CL_DATA_RECIPEENTRY where RECIPEID in
        <foreach  collection="oneDrRecsList" item="oneDrRec" index="index"
                  open="(" close=")" separator=",">
            #{oneDrRec}
        </foreach>
        and ischarge = '1'
    </select>
    <select id="mzCalculateClChrgentryFOs" resultType="com.julong.nucleicacid.entity.ClChrgentryFO">
        select
        100 AS discountrate,
        cft.deptid AS deptid,
        cft.docid AS docid,
        0 AS discountsum,
        xm.clcatalogid AS cataid,
        sum(cfmx.amount) AS totalsum,
        sum(cfmx.amount) AS spsum,
        sysdate AS inputtime,
        sum( nvl( cfmx.IMMAMOUNT , 0 ) ) AS immtotalsum
        from PC_CL_DATA_RECIPEENTRY cfmx , PC_CL_DATA_RECIPE cft ,ab_orderitem xm
        where cfmx.recipeid = cft.recipeid and cfmx.ischarge = '1' and cfmx.itemid = xm.itemid
        and cft.recipeid in
        <foreach  collection="oneDrRecsList" item="oneDrRec" index="index"
                  open="(" close=")" separator=",">
            #{oneDrRec}
        </foreach>
        group by cft.deptid, cft.docid , xm.clcatalogid
    </select>
    <select id="mzCalculateClInvoentryFOs" resultType="com.julong.nucleicacid.entity.ClInvoentryFO">
        select xm.clinvoicecataid  AS cataid,
               nvl( sum(cfmx.amount),0) AS amount,
               nvl(sum(cfmx.IMMAMOUNT),0) AS immamount
        from PC_CL_DATA_RECIPEENTRY cfmx , PC_CL_DATA_RECIPE cft ,ab_orderitem xm
        where cfmx.recipeid = cft.recipeid and cfmx.ischarge = '1' and cfmx.itemid = xm.itemid
        and cft.recipeid in
        <foreach  collection="oneDrRecsList" item="oneDrRec" index="index"
                  open="(" close=")" separator=",">
            #{oneDrRec}
        </foreach>
        group by xm.clinvoicecataid
    </select>
    <select id="getLisRequest" resultType="com.julong.nucleicacid.entity.LisRequestFO">
        select distinct '0'                                                                             as HISREQUESTID
                      , '1'                                                                             as TRUSTID
                      , to_char(cf.RECIPEID)                                                            as REQUESTNO
                      , to_char(mx.entryid)                                                             as HISID
                      , to_char(cf.encounterid)                                                         as PATIENTNO
                      , br.name                                                                         as PATIENTNAME
                      , br.hcno                                                                         as RXNO
                      , '1'                                                                             as PATIENTTYPE
                      , to_char(br.sex)                                                                 as PATIENTSEX
                      , br.idno                                                                         as PATIENTIDCARD
                      , br.mobile                                                                       as MOBILETELEPHONE
                      , br.BIRTHDAY                                                                     as PATIENTBIRTHDAY
                      , to_char(cf.DEPTID)                                                              as DEPTCODE
                      , (select deptname from om_department where deptid = cf.deptid and rownum &lt; 2) as DEPTNAME
                      , to_char(cf.docid)                                                               as DRCODE
                      , (select username from sm_user where userid = cf.docid and rownum &lt; 2)        as DRNAME
                      , ''                                                                              as DIAGNAME
                      , ''                                                                              as BEDNO
                      , ''                                                                              as REQUESTAIM
                      , to_char(mx.itemid)                                                              as ITEMCODE
                      , (select GROUPCODE from ab_ordergroup where groupid = mx.itemid)                 as ITEMCODE
                      , (select GROUPNAME from ab_ordergroup where groupid = mx.itemid)                 as ITEMNAME
                      , (select to_char(nvl(sum(mx3.amount), 0))
                         from pc_cl_data_recipeentry mx3
                         where mx3.ischarge = '1'
                           and mx3.recipeid = cf.recipeid
                           and mx3.groupno = mx.groupno)                                                as ITEMPRICE
                      , ''                                                                              as SAMPLENAME
                      , '0'                                                                             as TRANSTTAG
                      , decode(instr(nvl(mx.note, 'null'), 'T'), 0, '1', '3')                           as PRI
                      , '0'                                                                             as SENDDRMESSAGE
                      , '0'                                                                             as SENDPATIENTMESSAGE
                      , '0'                                                                             as SENDLABMESSAGE
                      , sysdate                                                                         as REQUESTTIME
                      , mx.note                                                                         as NOTE
                      , '-1'                                                                            as CHARGEID
        from pc_cl_data_recipeentry mx
           , pc_cl_data_recipe cf
           , pa_data_patient br
           , pc_cl_data_recipeentry mx2
        where cf.RECIPEID = mx.RECIPEID
          and br.patientid = cf.patientid
          and mx2.itemsource = 10
          and mx2.entrytype = 7
          and mx.recipeid = mx2.recipeid
          and mx.entrytype = 99
          and mx.groupno = mx2.groupno
          and mx2.recipeid in
              <foreach  collection="oneDrRecsList" item="oneDrRec" index="index"
                                         open="(" close=")" separator=",">
        #{oneDrRec}
             </foreach>
        union all
        select distinct '0'                                                                             as HISREQUESTID
                      , '1'                                                                             as TRUSTID
                      , to_char(cf.RECIPEID)                                                            as REQUESTNO
                      , to_char(mx.entryid)                                                             as HISID
                      , to_char(cf.encounterid)                                                         as PATIENTNO
                      , br.name                                                                         as PATIENTNAME
                      , br.hcno                                                                         as RXNO
                      , '1'                                                                             as PATIENTTYPE
                      , to_char(br.sex)                                                                 as PATIENTSEX
                      , br.idno                                                                         as PATIENTIDCARD
                      , br.mobile                                                                       as MOBILETELEPHONE
                      , br.BIRTHDAY                                                                     as PATIENTBIRTHDAY
                      , to_char(cf.DEPTID)                                                              as DEPTCODE
                      , (select deptname from om_department where deptid = cf.deptid and rownum &lt; 2) as DEPTNAME
                      , to_char(cf.docid)                                                               as DRCODE
                      , (select username from sm_user where userid = cf.docid and rownum &lt; 2)        as DRNAME
                      , ''                                                                              as DIAGNAME
                      , ''                                                                              as BEDNO
                      , ''                                                                              as REQUESTAIM
                      , to_char(mx.itemid)                                                              as ITEMCODE
                      , (select itemcode from ab_orderitem where itemid = mx.itemid)                    as ITEMCODE
                      , (select itemname from ab_orderitem where itemid = mx.itemid)                    as ITEMNAME
                      , (select to_char(nvl(sum(mx3.amount), 0))
                         from pc_cl_data_recipeentry mx3
                         where mx3.ischarge = '1'
                           and mx3.recipeid = cf.recipeid
                           and mx3.groupno = mx.groupno)                                                as ITEMPRICE
                      , ''                                                                              as SAMPLENAME
                      , '0'                                                                             as TRANSTTAG
                      , decode(instr(nvl(mx.note, 'null'), 'T'), 0, '1', '3')                           as PRI
                      , '0'                                                                             as SENDDRMESSAGE
                      , '0'                                                                             as SENDPATIENTMESSAGE
                      , '0'                                                                             as SENDLABMESSAGE
                      , sysdate                                                                         as REQUESTTIME
                      , mx.note                                                                         as NOTE
                      , '-1'                                                                            as CHARGEID
        from pc_cl_data_recipeentry mx,
             pc_cl_data_recipe cf,
             pa_data_patient br
        where cf.RECIPEID = mx.RECIPEID
          and br.patientid = cf.patientid
          and mx.itemsource = 1
          and mx.entrytype = 7
          and mx.recipeid in
              <foreach  collection="oneDrRecsList" item="oneDrRec" index="index"
                                        open="(" close=")" separator=",">
        #{oneDrRec}
    </foreach>
    </select>
    <select id="getNeedDispMed1" resultType="java.lang.Long">
        select count(cfmx.RECIPEID) from PC_CL_DATA_RECIPEentry cfmx
					where cfmx.recipeid = #{recipeId} and cfmx.ENTRYTYPE in (  1,3,4,5 )
					 and cfmx.ITEMSOURCE not in (2,3,4,7,8,9,12,13 )
    </select>
    <select id="getNeedDispMed2" resultType="java.lang.Long">
        select count(cfmx.RECIPEID) from MA_AGENT dy , PC_CL_DATA_RECIPEentry cfmx
		where dy.itemid = cfmx.ITEMID  and cfmx.RECIPEID = #{recipeId}  and dy.ENCOUNTERTYPE = 1
    </select>
    <select id="getDrugisPriortyPack" resultType="java.lang.String">
         select nvl( d.isprioritypack,'0') from ab_orderitem o , PH_DRUGITEM d
         where o.itemid = #{itemid} and o.drugitemid = d.drugid    and rownum &lt; 2
    </select>
    <select id="getAgentFO" resultType="com.julong.nucleicacid.entity.AgentFO">
        select  * from MA_AGENT  fo  where fo.itemID = #{itemID} and
					fo.encounterType = #{encounterType}
    </select>
    <select id="getPharmacyQueueFOs" resultType="com.julong.nucleicacid.entity.ClMdqueueFO">
        select * from MA_CL_DATA_PHARMACYQUEUE  fo  where fo.windowID = #{winID} and     (fo.queueStatus = 1 or   fo.queueStatus = 2) order by fo.queueTime

    </select>
    <select id="getCompletedPayInfo" resultType="com.julong.nucleicacid.model.GetCompletedPayInfoOutSet" parameterType="com.julong.nucleicacid.model.GetCompletedPayInfoIn">
    select
    --clinicSeq	payListInfo	String	是	就诊流水号
    to_char(clr.ENCOUNTERID) AS clinicSeq,
    --clinicTime	payListInfo	String	是	就诊日期
    to_char(clr.REGTIME,'yyyy-MM-dd')AS clinicTime,
    --hospitalId	payListInfo	String	是	医院代码
    '-' AS hospitalId,
    --deptId	payListInfo	String	是	接诊科室代码
    to_char(clr.REGDEPT) AS deptId,
    --deptName	payListInfo	String	是	接诊科室名称
    (select DEPTNAME from OM_DEPARTMENT where DEPTID = clr.REGDEPT) AS deptName,
    --doctorId	payListInfo	String	是	接诊医生代码
    clr.REGDOCTOR AS doctorId,
    --doctorName	payListInfo	String	是	接诊医生姓名
    (select USERNAME from SM_USER where USERID = clr.REGDOCTOR)AS doctorName,
    --payAmout	payListInfo	String	是	自费金额(单位：分)
    abc.SPSUM AS payAmout,
    --recPayAmout	payListInfo	String	是	统筹金额(单位：分)
    abc.ACCTSUM AS recPayAmout,
    --totalPayAmout	payListInfo	String	是	总金额(单位：分)
    abc.TOTALSUM AS totalPayAmout,
    --receiptId	payListInfo	String	是	收据ID
    abi.INVOICEID AS receiptId,
    --chargeDate	payListInfo	String	是	缴费日期
    to_char(abc.CHARGETIME,'yyyy-MM-dd')AS chargeDate,
    --remark	payListInfo	String	否	备注
    '-'AS remark,
    --orderId	payListInfo	String	否	支付平台订单号
    hcm.PSORDNUM AS orderId,
    --allowRefund	payListInfo	String	否	是否允许退费，1表示允许退费，0表示不允许，默认值为0
    '0'AS allowRefund,
    --prescriptionIds	payListInfo	String	否	处方号,允许线上退费时必须
    --AS prescriptionIds,
    --refundType	payListInfo	String	否	退费方式， 线上退费填"online"
    --AS refundType,
    --refundNo	payListInfo	String	否	退费流水号，refundStatus=1或者2时必须
    --AS refundNo,
    --refundStatus	payListInfo	orderInfo	否	退费状态 0已支付 1退费中 2 已退费
     decode(abc.ISBEREFUNDED,'1','2','0')AS refundStatus
    --refundFee	payListInfo	String	否	退费自费金额，单位分
    --AS refundFee,
    --refundTime	payListInfo	String	否	退费时间 yyyy-MM-dd HH:mm:ss
    --AS refundTime,
    --hasExpress	payListInfo	String	否	是否有药品快递信息 1包含 0不包含
    --AS hasExpress,
    --deliveryStatus	payListInfo	String	否	药品物流状态0 或空，不支持配送1 可配送2 已配送
    --AS deliveryStatus,
    --medicineCode	payListInfo	String	否	取药码
    --AS medicineCode,
    --pickUpLocation	payListInfo	String	否	取药药房
    --AS pickUpLocation
    --
    from AB_CL_DATA_CHARGE abc ,PA_DATA_PATIENT pat, PA_CL_DATA_REGISTER clr ,AB_CL_DATA_INVOICE abi, HC_MOBILEPAYMENT hcm
        where abc.CHARGEID = abi.CHARGEID and  to_char(abc.CHARGEID )= hcm.CHRGNO and abc.HCNO = pat.HCNO and pat.PATIENTID = clr.PATIENTID   AND abc.ISDELETE = '0'
          and hcm.TYPE in('1','3','11','31')
          AND abc.HCNO = #{healthCardNo}
          AND pat.PATIENTID = #{patientId}
          AND to_char(clr.REGTIME,'yyyy-MM-dd')> = #{startDate}
          AND to_char(clr.REGTIME,'yyyy-MM-dd')&lt; = #{endDate}
    </select>
    <resultMap id="getCompletedPayDetailInfoMap" type="com.julong.nucleicacid.model.GetCompletedPayDetailInfoOut">
        <collection  property="prescriptionIds"  ofType="String">
            <constructor>
                <arg column="prescriptionId1" />
            </constructor>
        </collection>
        <collection property="orderDetailInfo" ofType="com.julong.nucleicacid.model.GetCompletedPayDetailInfoOutSet">
            <id column="detailId" property="detailId"/>
            <result column="detailFee" property="detailFee"/>
            <result column="detailName" property="detailName"/>
            <result column="detailCount" property="detailCount"/>
            <result column="detailUnit" property="detailUnit"/>
            <result column="detailAmout" property="detailAmout"/>
            <result column="detailSpec" property="detailSpec"/>
            <result column="detailPrice" property="detailPrice"/>
            <result column="usage" property="usage"/>
            <result column="usageAdvice" property="usageAdvice"/>
        </collection>
    </resultMap>
    <select id="getCompletedPayDetailInfo" resultMap="getCompletedPayDetailInfoMap" resultType="com.julong.nucleicacid.model.GetCompletedPayDetailInfoOut" parameterType="com.julong.nucleicacid.model.GetCompletedPayDetailInfoIn">
        select
        --isMedicinalDetail	res	String	否	是否查看药品明细（1有，0 无）
        '1' AS isMedicinalDetail,
        --prescriptionId	res	String	否	处方号（用于查看发药信息必填）多个分方则以英文逗号拼接
        to_char(pcr.RECIPEID) AS prescriptionId1,
        --invoiceNo	res	String	否	虚拟发票号
        abi.INVOICENO AS invoiceNo,
        --payType	res	String	否	付款方式
        hcm.PAYMODE AS payType,
        --machineNo	res	String	否	终端编号
        --tradeDate	res	String	否	交易时间
        hcm.PAYTIME AS tradeDate,
        --tradeNo	res	String	否	交易平台流水号
        hcm.AGTORDNUM AS tradeNo,
        --invoiceUrl	res	String	否	电子票据地址url(此地址非空时将不允许退费)
        --orderDetailInfo	res	List orderDetailInfo	否	缴费订单明细集合
        --detailFee	orderDetailInfo	String	是	缴费费别
        (select PAYORNAME from AB_PAYOR where PAYORID = abc.PAYORID) AS detailFee,
        --detailId	orderDetailInfo	String	是	缴费细目流水号，要求唯一
        pcre.ENTRYID AS detailId,
        --detailName	orderDetailInfo	String	是	缴费细目名称
        abo.ITEMNAME AS detailName,
        --detailCount	orderDetailInfo	String	是	缴费细目数量
        TO_CHAR(pcre.QUANTITY) AS detailCount,
        --detailUnit	orderDetailInfo	String	是	缴费细目单位
        (select UNITNAME from ma_unit where UNITID =  pcre.QUANUNITID )AS detailUnit,
        --detailAmout	orderDetailInfo	String	是	缴费细目金额，单位：分
        to_char(pcre.AMOUNT ) AS detailAmout,
        --detailSpec	orderDetailInfo	String	是	缴费规格
        abo.STANDARD AS detailSpec,
        --detailPrice	orderDetailInfo	String	是	缴费细目单价，单位：分
        pcre.PRICE AS detailPrice,
        --usage	orderDetailInfo	String	是	用法格式：每次处方用量/每天频率/天数/（服药方法、给药途径）例如：1片/3did/4/口服
        TO_CHAR(pcre.DOSAGE) || '/' || (select FREQNAME from PH_FREQUENCY where FREQID = pcre.FREQUENCYID) || '/' ||
        to_char(pcre.days)  || '/' || (select DIRENAME from PH_DIRECTION where DIREID = pcre.DIRECTIONID) AS usage,
        --usageAdvice	orderDetailInfo	String	否	用法嘱托 例如：服用前切忌饮酒
        (select NOTENAME from PH_FREQUENCYNOTE where OID = pcre.FREQUENCYID) AS usageAdvice
        --detailDeliverStatus	orderDetailInfo	String	否	药品物流状态 0或空,支持配送1不可配送
        --remark	orderDetailInfo	String	否	备注
        --
        from AB_CL_DATA_INVOICE abi, AB_CL_DATA_CHARGE abc ,PC_CL_DATA_RECIPE pcr,
             PC_CL_DATA_RECIPEENTRY pcre, HC_MOBILEPAYMENT hcm, AB_ORDERITEM abo

        where abi.CHARGEID = abc.CHARGEID and abc.CHARGEID = pcr.CHARGEID and pcr.RECIPEID = pcre.RECIPEID
          and to_char(abc.CHARGEID) = hcm.CHRGNO AND pcre.ITEMID = abo.ITEMID
          and abi.INVOICEID = #{receiptId}
          and to_char(pcr.ENCOUNTERID) = #{clinicSeq}
            --需要收费
        and pcre.ISCHARGE = '1'

       </select>
    <select id="getDoctorInfo" resultType="com.julong.nucleicacid.model.GetDoctorInfoOutSet" parameterType="com.julong.nucleicacid.model.GetDoctorInfoOutSet">
        select
        --doctorId	doctorInfo	String	是	医生ID
        use.USERID AS doctorId,
        --doctorName	doctorInfo	String	是	医生名称
        use.USERNAME AS doctorName,
        --doctorLevelCode	doctorInfo	String	是	医生职称代码
        to_char(usi.RANKID ) AS doctorLevelCode,
        --doctorLevel	doctorInfo	String	是	医生职称
        (SELECT RANKNAME FROM OM_RANK  WHERE RANKID = usi.RANKID) AS doctorLevel,
        --deptId	doctorInfo	String	是	科室代码
        to_char(usl.LOCID) AS deptId,
        --deptName	doctorInfo	String	是	科室名称
        dept.DEPTNAME AS deptName
        --description	doctorInfo	String	否	医生简介
        from SM_USER use ,SM_USERINFO usi , SM_USERLOC usl, OM_DEPARTMENT dept
        WHERE use.USERID = usi.USERID AND use.USERID = usl.USERID AND usl.LOCID = dept.DEPTID AND usl.ISDEFAULT = '1'

        <if test=" deptId!=null and deptId !=''">
            AND usl.LOCID = #{deptId}
        </if>
        <if test=" doctorId!=null and doctorId !=''">
            AND usl.LOCID = #{doctorId}
        </if>
    </select>
    <select id="getDeptInfo" resultType="com.julong.nucleicacid.model.GetDeptInfoOutSet" parameterType="com.julong.nucleicacid.model.GetDeptInfoIn">
        select
        --deptId	deptInfo	String	是	科室代码*/
        to_char(dept.DEPTID)AS  deptId,
        --deptName	deptInfo	String	是	科室名称*/
        dept.DEPTNAME AS  deptName,
        --deptType	deptInfo	Integer	是	1专科2 专家*/
        '-' AS  deptType,
        --parentId	deptInfo	String	是	上级科室代码,没有填-1*/
        to_char(dept.parentID) AS  parentId,
        --description	deptInfo	String	是	科室简介 */
        '-' AS  description
        from OM_DEPARTMENT dept
        where dept.ISDELETE = '0'
        <if test=" deptId!=null and deptId !=''">
            AND dept.DEPTID = #{deptId}
        </if>
        <if test=" deptType!=null and deptType !=''">

        </if>
    </select>
    <select id="getRegisterInfoIn" resultType="com.julong.nucleicacid.model.GetRegisterInfoOutSet"
            parameterType="com.julong.nucleicacid.model.GetRegisterInfoIn">
        select
            --healthCardNo	req	String	否	患者卡号*/
            clr.HCNO                             AS healthCardNo,
            --clinicSeq	req	String	否	就诊流水*/
            to_char(clr.ENCOUNTERID)             AS clinicSeq,
            --patientId	req	String	否	患者ID*/
            to_char(clr.PATIENTID)               AS patientId,
            --orderId	req	String	否	移动订单号*/
            clr.BOOKID                           AS orderId,
            --orderDate	req	String	否	挂号日期【格式：YYYY-MM-DD】*/
            to_char(clr.REGTIME, 'yyyy-MM-dd')  AS orderDate,
            --visitDate	req	String	否	就诊日期【格式：YYYY-MM-DD】*/
            to_char(clr.INPUTTIME, 'yyyy-MM-dd')  AS visitDate,
            --patientName	req	String	否	患者姓名*/
            clr.NAME                             AS patientName,
            --idCardNo	req	String	否	身份证号码*/
            clr.IDNO                             AS idCardNo,
            --bookingNo	req	String	否	HIS预约订单号/当天挂号锁号ID*/
            -- AS bookingNo,
            --doctorId	req	String	否	医生ID*/
            to_char(clr.REGDOCTOR)               AS doctorId,
            --orderStatus	req	String	否	挂号状态：* 0：未取号 * 1：已取号* 2：已退费(已取号)* 3: 已就诊* 4：未付费取消* 5: 已付费已取消* 6: 允许预约报到* 7：已爽约* */
            DECODE(clr.ENCOUNTERSTATUS)  AS orderStatus,

        --/**status 是否已取号：（当处理结果代码为0时，该字段必输） 0：未取号 1：已取号 2：已退费(已取号) 3: 已就诊4：未付费取消 5: 已付费已取消  6: 允许预约报到 7：已爽约8：可签到（需为已支付）  9：已签到
       case
            when clr.isCharge = '0' and clr.BOOKSTATUS = 4 then '4'
            when clr.isCharge = '1' and clr.BOOKSTATUS = 4 then '5'
            when clr.ISBOOK = '1' and clr.isCharge = '0' and clr.bookStatus = 1 then '6'
            when clr.ISBOOK = '1' and clr.bookStatus = 3 then '7'
            when clr.ISBOOK = '1' and clr.isCharge = '1' and clr.bookStatus = 1 then '8'
            when clr.ISBOOK = '1' and clr.bookStatus = 2 then '9'
            when clr.encounterStatus = 2 and vis.VISITSTATUS then '3'
           end AS status,
        --/**healthCardNo	orderInfo	String	是	患者卡号*/
        clr.HCNO                             AS healthCardNo,
        --/**patientName	orderInfo	String	是	患者姓名*/
        clr.NAME                             AS patientName,
        --/**patientId	orderInfo	String	是	患者ID*/
        to_char(clr.PATIENTID)               AS patientId,
        --/**orderId	orderInfo	String	是	移动订单号*/
        clr.BOOKID AS orderId,
        --/**bookingNo	orderInfo	String	是	HIS预约订单号/当天挂号锁号ID*/
        to_char(clr.ENCOUNTERID)             AS bookingNo,
        --/**clinicSeq	orderInfo	String	是	就诊流水号*/
        to_char(clr.ENCOUNTERID)             AS clinicSeq,
        --/**hospitalId	orderInfo	String	否	医院代码 第三方挂的号要在服务平台支付，则该参数必传*/
        --AS hospitalId,
        --/**deptId	orderInfo	String	是	科室代码*/
        to_char(clr.REGDEPT) AS deptId,
        --/**deptName	orderInfo	String	是	科室名称*/
        (select DEPTNAME from OM_DEPARTMENT where DEPTID = clr.REGDEPT)AS deptName,
        --/**doctorId	orderInfo	String	否	接诊医生代码*/
        to_char(clr.REGDOCTOR)               AS doctorId,
        --/**doctorName	orderInfo	String	否	接诊医生姓名*/
        (select USERNAME from SM_USER where USERID = clr.REGDOCTOR)AS doctorName,
        --/**regDate	orderInfo	String 	否	就诊日期*/
        to_char(clr.REGTIME, 'yyyy-MM-dd')   AS regDate,
        --/**shiftCode	orderInfo	String	否	班别代码*/
        --AS shiftCode,
        --/**shiftName	orderInfo	String	否	班别名称，如上午、下午*/
        --AS shiftName,
        --/**startTime	orderInfo	String	否	分时开始时间，格式：HH:MI*/
        --AS startTime,
        --/**endTime	orderInfo	String	否	分时结束时间，格式：HH:MI*/
        --AS endTime,
        --/**svObjectId	orderInfo	String	否	服务对象id，默认为普通患者*/
        --AS svObjectId,
        --/**svObjectName	orderInfo	String	否	患者服务对象(人群 )*/
        --AS svObjectName,
        --/**scheduleId	orderInfo	String	否	排班号*/
        --AS scheduleId,
        --/**roomAddress	orderInfo	String	否	出诊位置*/
        --AS roomAddress,
        --/**registerType	orderInfo	String	是	挂号类型 0-预约挂号 1-当天挂号*/
        decode(clr.REGTYPE, 6,'1','0')AS registerType,
        --/**queueNo	orderInfo	String	是	排队序号*/
        to_char(vis.dayDeptNo)AS queueNo,
        --/**waitingCount	orderInfo	Sring	否	前面就诊人数，如果患者已就诊，则设为-1*/
        --AS waitingCount,
        --/**waitingTime	orderInfo	Sring	否	预计候诊等待时间(分钟) 例:1患者就诊设置3分分钟，10个患者预计候诊30分钟*/
        --AS waitingTime,
        --/**infoTime	orderInfo	String	否	取号时间格式： YYYY-MM-DD HI24:MI:SS*/
        --AS infoTime,
        --/**visitTime	orderInfo	String	否	就诊时间（实际接诊时间） YYYY-MM-DD HI24:MI:SS*/
        --AS visitTime,
        --/**orderType	orderInfo	String	是	挂号来源 10-金蝶微信 11-金蝶支付宝（其他渠道的值his自定义）*/
        '-' AS orderType,
        --/**orderTypeName	orderInfo	String	否	挂号来源名称*/
        --AS orderTypeName,
        --/**orderTime	orderInfo	String	是	挂号下单时间*/
        to_char(clr.INPUTTIME, 'yyyy-MM-dd hh:mm:ss') AS orderTime,
        --/**remark	orderInfo	String	否	备注*/
        --AS remark,
        --/**isCancelabe	orderInfo	String	是	是否可以取消，0-不可以，1-可以，2-未定义，移动平台可根据自己的规则控制。*/
        '2'AS isCancelabe,
        --/**isPayment 	orderInfo	String	否	是否允许支付【0-不允许；1-允许】 默认值为1*/
        --AS isPayment ,
        --/**payStatus	orderInfo	String	是	支付状态 0-未支付 1-已支付 2-已退费*/
        --AS payStatus,
        --/**regFee	orderInfo	String	是	挂号费(单位“分”)*/
        --AS regFee,
        --/**treatFee	orderInfo	String	是	诊疗费(单位“分”)*/
        --AS treatFee,
        --/**yhFee	orderInfo	String	是	优惠挂号费(单位“分”)*/
        --AS yhFee,
        --/**payFee	orderInfo	String	是	实际支付费用(单位“分”) payFee = regFee + treatFee - yhFee*/
        --AS payFee,
        --/**isSelectSvObject	orderInfo	String	否	是否允许选择服务对象  0-不允许，1-允许默认值为0,该参数只针对第三方渠道的挂号订单，在支付前选择服务对象。*/
        --AS isSelectSvObject,
        --/**autoLockBeforePay	orderInfo	String	否	挂号支付前，是否必须先锁号  0-不允许，1-允许默认值为0，该参数只针对第三方渠道的挂号订单。*/
        --AS autoLockBeforePay,
        --
        from PA_CL_DATA_REGISTER clr ,PA_CL_DATA_VISITQUEUE vis
        where clr.ENCOUNTERID = vis.ENCOUNTERID(+)
            <if test=" healthCardNo!=null and healthCardNo !=''">
                AND clr.HCNO = #{healthCardNo}
            </if>
            <if test=" clinicSeq!=null and clinicSeq !=''">
                AND clr.ENCOUNTERID = #{clinicSeq}
            </if>
            <if test=" patientId!=null and patientId !=''">
                AND clr.PATIENTID = #{patientId}
            </if>
            <if test=" orderId!=null and orderId !=''">
                AND clr.BOOKID = #{orderId}
            </if>
            <if test=" orderDate!=null and orderDate !=''">
                AND   to_char(clr.INPUTTIME, 'yyyy-MM-dd') = #{orderDate}
            </if>
            <if test=" visitDate!=null and visitDate !=''">
                AND to_char(clr.REGTIME, 'yyyy-MM-dd') = #{visitDate}
            </if>
            <if test=" patientName!=null and patientName !=''">
                AND clr.NAME = #{patientName}
            </if>
            <if test=" idCardNo!=null and idCardNo !=''">
                AND clr.IDNO = #{idCardNo}
            </if>

            <if test=" bookingNo!=null and bookingNo !=''">

            </if>
            <if test=" doctorId!=null and doctorId !=''">
                AND to_char(clr.REGDOCTOR)  = #{doctorId}
            </if>
            <if test=" orderStatus!=null and orderStatus !=''">
                AND clr.ENCOUNTERSTATUS = #{orderStatus}
            </if>

    </select>
    <select id="getDeptInfoApp" resultType="com.julong.nucleicacid.model.GetDeptInfoAppOutSet"
    parameterType="com.julong.nucleicacid.model.GetDeptInfoIn">
        select
        --deptId	deptInfo	String	是	科室代码*/
        to_char(dept.DEPTID)AS  deptId,
        --deptName	deptInfo	String	是	科室名称*/
        dept.DEPTNAME AS  deptName,
        --deptType	deptInfo	Integer	是	1专科2 专家*/
        '-' AS  deptType,
        --parentId	deptInfo	String	是	上级科室代码,没有填-1*/
        to_char(dept.parentID) AS  parentId,
        --description	deptInfo	String	是	科室简介 */
        '-' AS  description,
        --orderNo	deptInfo	String	否	排序号
        dept.SORT AS orderNo,
        --keyDeptLevel	deptInfo	String	否	重点科室标示
        --01，国家临床重点专科；
        --02，国家区域中医诊疗中心；
        --03，国家中医重点专科；
        --04，省重点中医专科
        '-' AS keyDeptLevel
        from OM_DEPARTMENT dept
        where dept.ISDELETE = '0'
        <if test=" deptId!=null and deptId !=''">
            AND dept.DEPTID = #{deptId}
        </if>
        <if test=" deptType!=null and deptType !=''">

        </if>
    </select>

</mapper>